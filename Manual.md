# Manual ‚Äî Local RAG Assistant

## 1. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–æ–µ–∫—Ç–∞ **Local RAG Assistant** –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, QA-–∏–Ω–∂–µ–Ω–µ—Ä–æ–≤, DevOps –∏ –ò–ò-–∞–≥–µ–Ω—Ç–æ–≤.

–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞;
- –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ UI-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (—Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π);
- –æ–ø–∏—Å–∞–Ω–∏–µ –±—ç–∫–µ–Ω–¥-–ª–æ–≥–∏–∫–∏ (—Ñ—É–Ω–∫—Ü–∏–∏, –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏, API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã);
- —Å—Ö–µ–º—ã –∫–ª—é—á–µ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö;
- –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–µ–∫—Ç–æ–º.

---

## 2. –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞

**Local RAG Assistant** ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π NotebookLM-–ø–æ–¥–æ–±–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç ¬´–Ω–æ—É—Ç–±—É–∫–∏¬ª, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤ –Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ã (PDF, DOCX, XLSX, TXT –∏ –¥—Ä.), —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —Å —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

–ö–ª—é—á–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞:
- –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∑–∞–∫—Ä—ã—Ç—ã—Ö –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ç—É—Ä–æ–≤).
- LLM –∏ embedding-–º–æ–¥–µ–ª–∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Ollama –∏–ª–∏ OpenAI-compatible API.
- –ü–æ–∏—Å–∫ ‚Äî –≥–∏–±—Ä–∏–¥–Ω—ã–π: –≤–µ–∫—Ç–æ—Ä–Ω—ã–π (cosine similarity) + –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π (FTS5/BM25), –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ RRF.
- –û—Ç–≤–µ—Ç—ã –ø–æ—Ç–æ–∫–æ–≤—ã–µ (SSE).

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
RAG/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ api/                    # –ë—ç–∫–µ–Ω–¥ (FastAPI, Python)
‚îÇ   ‚îî‚îÄ‚îÄ web/                    # –§—Ä–æ–Ω—Ç–µ–Ω–¥ (Next.js, TypeScript)
‚îú‚îÄ‚îÄ agent/
‚îÇ   ‚îú‚îÄ‚îÄ agent_001/              # –ê–≥–µ–Ω—Ç-001: –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ agent_002/              # –ê–≥–µ–Ω—Ç-002: manifest —Ç–æ–ª—å–∫–æ
‚îú‚îÄ‚îÄ data/                       # –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
‚îÇ   ‚îú‚îÄ‚îÄ docs/                   # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–ø–æ notebook_id)
‚îÇ   ‚îú‚îÄ‚îÄ parsing/                # JSON-—á–∞–Ω–∫–∏ –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–ø–æ notebook_id)
‚îÇ   ‚îú‚îÄ‚îÄ notebooks/              # SQLite –ë–î –Ω–∞ –∫–∞–∂–¥—ã–π –Ω–æ—É—Ç–±—É–∫ (–ø–æ–∏—Å–∫)
‚îÇ   ‚îú‚îÄ‚îÄ citations/              # –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã (JSON, –ø–æ notebook_id)
‚îÇ   ‚îú‚îÄ‚îÄ notes/                  # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ (JSON)
‚îÇ   ‚îú‚îÄ‚îÄ logs/sessions/          # –õ–æ–≥–∏ —Å–µ—Å—Å–∏–π (app_*.log, ui_*.log)
‚îÇ   ‚îî‚îÄ‚îÄ store.db                # –ì–ª–æ–±–∞–ª—å–Ω–∞—è SQLite –ë–î (–Ω–æ—É—Ç–±—É–∫–∏, –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞)
‚îú‚îÄ‚îÄ packages/                   # –ü—É—Å—Ç–æ–π –ø–∞–∫–µ—Ç-–∑–∞–≥–ª—É—à–∫–∞
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ dev_run.sh              # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –¥–ª—è Linux/macOS
‚îÇ   ‚îú‚îÄ‚îÄ verify.sh               # –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ cleanup_data.ps1        # PowerShell: –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ .env.example                # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ launch.bat                  # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π Windows-–ª–∞—É–Ω—á–µ—Ä
‚îú‚îÄ‚îÄ Makefile                    # make dev / make install / make test
‚îú‚îÄ‚îÄ Manual.md                   # –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
‚îú‚îÄ‚îÄ README.md                   # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –∑–∞–ø—É—Å–∫—É
‚îî‚îÄ‚îÄ requirements.txt            # –ö–æ—Ä–Ω–µ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç api + web)
```

### 3.1 –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `data/` ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

| –ü–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è / —Ñ–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| `data/store.db` | –ì–ª–æ–±–∞–ª—å–Ω–∞—è SQLite –ë–î: —Ç–∞–±–ª–∏—Ü—ã `notebooks`, `sources`, `parsing_settings`. –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏. |
| `data/docs/{notebook_id}/` | –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –≤ –Ω–æ—É—Ç–±—É–∫. |
| `data/parsing/{notebook_id}/{source_id}.json` | –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞: —Å–ø–∏—Å–æ–∫ —á–∞–Ω–∫–æ–≤ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (JSON-–º–∞—Å—Å–∏–≤). |
| `data/notebooks/{notebook_id}.db` | SQLite –ë–î –Ω–æ—É—Ç–±—É–∫–∞: —Ç–∞–±–ª–∏—Ü—ã `documents`, `chunks`, `chunks_fts`, `chunk_embeddings`, `tags`, `document_tags`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –∏ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞. |
| `data/citations/{notebook_id}/{citation_id}.json` | –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ü–∏—Ç–∞—Ç—ã (–∫–Ω–æ–ø–∫–∞ [N] –≤ —á–∞—Ç–µ). |
| `data/notes/{note_id}.json` | –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ (–∫–Ω–æ–ø–∫–∞ ‚Ü≥ –≤ —á–∞—Ç–µ), –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ –ª—é–±–æ–≥–æ –Ω–æ—É—Ç–±—É–∫–∞. |
| `data/logs/sessions/` | –õ–æ–≥–∏ —Å–µ—Å—Å–∏–∏: `app_<SESSION_ID>.log` ‚Äî —Å–µ—Ä–≤–µ—Ä, `ui_<SESSION_ID>.log` ‚Äî UI-—Å–æ–±—ã—Ç–∏—è. |

---

## 4. Frontend (`apps/web`)

### 4.1 –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:** –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Next.js App Router. –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ `app/` ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–æ –≤—Å–µ –æ–Ω–∏ –ø–æ–º–µ—á–µ–Ω—ã `'use client'`, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç React-—Ö—É–∫–∏. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ (Redux/Zustand) —á–µ—Ä–µ–∑ `useSyncExternalStore` + –º–æ–¥—É–ª—å–Ω—ã–µ —Å—Ç–æ—Ä—ã.

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è/–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| Next.js (App Router) | SSR/CSR —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ |
| TypeScript | –¢–∏–ø–∏–∑–∞—Ü–∏—è |
| TailwindCSS | –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è |
| TanStack Query (react-query) | Server state management (–∑–∞–ø—Ä–æ—Å—ã –∫ API, –∫—ç—à, –º—É—Ç–∞—Ü–∏–∏) |
| Zod | –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ API |
| EventSource (native) | SSE-—Å—Ç—Ä–∏–º–∏–Ω–≥ —á–∞—Ç–∞ |
| `useSyncExternalStore` | –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Å—Ç–æ—Ä—ã (–Ω–µ Zustand/Redux ‚Äî —Ä—É—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è) |

### 4.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```
apps/web/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ globals.css             # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx              # –ö–æ—Ä–Ω–µ–≤–æ–π layout (–æ–±—ë—Ä—Ç–∫–∞ Providers + StoreInitializer)
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                # –ö–æ—Ä–Ω–µ–≤–æ–π –º–∞—Ä—à—Ä—É—Ç (redirect –Ω–∞ /notebooks)
‚îÇ   ‚îî‚îÄ‚îÄ notebooks/
‚îÇ       ‚îú‚îÄ‚îÄ page.tsx            # –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ: —Å–ø–∏—Å–æ–∫ –Ω–æ—É—Ç–±—É–∫–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ [id]/
‚îÇ           ‚îî‚îÄ‚îÄ page.tsx        # –†–ê–ë–û–ß–ï–ï –û–ö–ù–û: –ª–µ–≤–∞—è + —Ü–µ–Ω—Ç—Ä + –ø—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª–∏
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ SourcesPanel.tsx        # –õ–ï–í–û–ï –í–´–î–í–ò–ñ–ù–û–ï –ú–ï–ù–Æ: —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ChatPanel.tsx           # –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –ü–ê–ù–ï–õ–¨: —á–∞—Ç
‚îÇ   ‚îú‚îÄ‚îÄ EvidencePanel.tsx       # –ü–†–ê–í–û–ï –í–´–î–í–ò–ñ–ù–û–ï –ú–ï–ù–Æ: —Ü–∏—Ç–∞—Ç—ã –∏ –∑–∞–º–µ—Ç–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ RuntimeSettings.tsx     # –ë–õ–û–ö –ù–ê–°–¢–†–û–ï–ö –ü–†–û–í–ê–ô–î–ï–†–ê LLM
‚îÇ   ‚îú‚îÄ‚îÄ ParsingSettingsPanel.tsx# –ë–ª–æ–∫ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ ConnectionIndicator.tsx # –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è LLM
‚îÇ   ‚îú‚îÄ‚îÄ providers.tsx           # TanStack Query –ø—Ä–æ–≤–∞–π–¥–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ StoreInitializer.tsx    # –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–æ—Ä–æ–≤
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ api.ts                  # HTTP-–∫–ª–∏–µ–Ω—Ç (–≤—Å–µ REST-–≤—ã–∑–æ–≤—ã –∫ –±—ç–∫–µ–Ω–¥—É)
‚îÇ   ‚îú‚îÄ‚îÄ sse.ts                  # SSE-–∫–ª–∏–µ–Ω—Ç –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ —á–∞—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ runtime-config.ts       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LLM-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (localStorage)
‚îÇ   ‚îî‚îÄ‚îÄ clientLogger.ts         # –õ–æ–≥–≥–µ—Ä UI-—Å–æ–±—ã—Ç–∏–π (POST /api/client-events)
‚îú‚îÄ‚îÄ src/stores/
‚îÇ   ‚îú‚îÄ‚îÄ chatStore.ts            # –°—Ç–æ—Ä: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ —á–∞—Ç–∞, –ø–æ—Ç–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ modeStore.ts            # –°—Ç–æ—Ä: —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —á–∞—Ç–∞ (rag/model/agent)
‚îÇ   ‚îú‚îÄ‚îÄ connectionStore.ts      # –°—Ç–æ—Ä: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è LLM
‚îÇ   ‚îî‚îÄ‚îÄ agentStore.ts           # –°—Ç–æ—Ä: –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ dto.ts                  # TypeScript-—Ç–∏–ø—ã –∏ Zod-—Å—Ö–µ–º—ã DTO
‚îú‚îÄ‚îÄ e2e/
‚îÇ   ‚îî‚îÄ‚îÄ notebook-chat.spec.ts   # Playwright e2e —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ next.config.mjs             # Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tailwind.config.ts          # Tailwind –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tsconfig.json               # TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ package.json                # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
```

---

### 4.3 –ö–æ—Ä–Ω–µ–≤—ã–µ —Ñ–∞–π–ª—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

#### `app/layout.tsx` ‚Äî –ö–æ—Ä–Ω–µ–≤–æ–π Layout

–û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –¥–≤–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:
- `<Providers>` ‚Äî TanStack Query `QueryClientProvider` (–∏–∑ `components/providers.tsx`).
- `<StoreInitializer>` ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –≤—ã–∑—ã–≤–∞—é—â–∏–π `initializeModeStore()`, `initializeConnectionStore()`, `initializeAgentStore()` –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (–∏–∑ `components/StoreInitializer.tsx`).

#### `app/page.tsx` ‚Äî –ö–æ—Ä–Ω–µ–≤–æ–π –º–∞—Ä—à—Ä—É—Ç

–ü—Ä–æ—Å—Ç–æ–π —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–µ–ª–∞–µ—Ç `redirect('/notebooks')`. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–æ—É—Ç–±—É–∫–æ–≤.

---

### 4.4 –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –Ω–æ—É—Ç–±—É–∫–æ–≤

**–§–∞–π–ª:** `apps/web/app/notebooks/page.tsx`

–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –Ω–æ—É—Ç–±—É–∫–æ–≤ ‚Äî –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [h1: Notebooks]  [ConnectionIndicator]      [–ù–æ–≤—ã–π –Ω–æ—É—Ç–±—É–∫ ‚ñ∂]  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –°–ø–∏—Å–æ–∫ –Ω–æ—É—Ç–±—É–∫–æ–≤:               ‚îÇ  –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫:     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ  [‚Üí/‚Üê —Å–≤–µ—Ä–Ω—É—Ç—å]              ‚îÇ
‚îÇ  ‚îÇ –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ—É—Ç–±—É–∫–∞        ‚îÇ    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è          ‚îÇ    ‚îÇ  ‚îÇ [‚àí] –ü—Ä–æ–≤–∞–π–¥–µ—Ä LLM    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ [–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å] [–î—É–±–ª.]  ‚îÇ    ‚îÇ  ‚îÇ   <RuntimeSettings>  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ [–£–¥–∞–ª–∏—Ç—å]                ‚îÇ    ‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ  ‚îÇ [‚àí] –ì–ª–æ–±. –ø–∞—Ä—Å–∏–Ω–≥   ‚îÇ    ‚îÇ
‚îÇ  ...                             ‚îÇ  ‚îÇ   <ParsingSettings>  ‚îÇ    ‚îÇ
‚îÇ                                  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (useState)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢–∏–ø | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|
| `isSettingsOpen` | `boolean` | –°–≤—ë—Ä–Ω—É—Ç–∞/—Ä–∞—Å–∫—Ä—ã—Ç–∞ –ø—Ä–∞–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ |
| `isRuntimeOpen` | `boolean` | –°–≤—ë—Ä–Ω—É—Ç/—Ä–∞—Å–∫—Ä—ã—Ç –±–ª–æ–∫ ¬´–ü—Ä–æ–≤–∞–π–¥–µ—Ä LLM¬ª |
| `isParsingOpen` | `boolean` | –°–≤—ë—Ä–Ω—É—Ç/—Ä–∞—Å–∫—Ä—ã—Ç –±–ª–æ–∫ ¬´–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞¬ª |
| `selectedNotebookId` | `string\|null` | –ê–∫—Ç–∏–≤–Ω—ã–π –Ω–æ—É—Ç–±—É–∫ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ |
| `isDialogOpen` | `boolean` | –û—Ç–∫—Ä—ã—Ç –¥–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ—É—Ç–±—É–∫–∞ |
| `newNotebookName` | `string` | –¢–µ–∫—É—â–µ–µ –∏–º—è –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| `isRenameDialogOpen` | `boolean` | –û—Ç–∫—Ä—ã—Ç –¥–∏–∞–ª–æ–≥ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è |
| `renamingNotebookId` | `string\|null` | ID –Ω–æ—É—Ç–±—É–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è |
| `renameNotebookName` | `string` | –¢–µ–∫—É—â–µ–µ –∏–º—è –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è |

#### TanStack Query (–¥–∞–Ω–Ω—ã–µ –∏ –º—É—Ç–∞—Ü–∏–∏)

| –•—É–∫ | Key | –î–µ–π—Å—Ç–≤–∏–µ |
|---|---|---|
| `useQuery` | `['notebooks']` | –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–æ—É—Ç–±—É–∫–æ–≤: `api.listNotebooks()` |
| `useMutation` | `createNotebook` | `api.createNotebook(title)` ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç `['notebooks']` |
| `useMutation` | `deleteNotebook` | `api.deleteNotebook(id)` ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç `['notebooks']` |
| `useMutation` | `renameNotebook` | `api.renameNotebook(id, title)` ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç `['notebooks']` |
| `useMutation` | `duplicateNotebook` | `api.duplicateNotebook(id)` ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç `['notebooks']` |

#### UI-—ç–ª–µ–º–µ–Ω—Ç—ã –∏ –∏—Ö —Ñ—É–Ω–∫—Ü–∏–∏

| –≠–ª–µ–º–µ–Ω—Ç | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ / –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `[–ù–æ–≤—ã–π –Ω–æ—É—Ç–±—É–∫]` | `openDialog()` | –õ–æ–≥–∏—Ä—É–µ—Ç `ui.notebook.create_dialog_open`, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω—ã–π –¥–∏–∞–ª–æ–≥ |
| –°–ø–∏—Å–æ–∫ –Ω–æ—É—Ç–±—É–∫–æ–≤ | `onClick` ‚Üí `setSelectedNotebookId` | –í—ã–¥–µ–ª—è–µ—Ç –Ω–æ—É—Ç–±—É–∫ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ |
| `<Link href="/notebooks/{id}">` | ‚Äî | –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–±–æ—á–µ–µ –æ–∫–Ω–æ –Ω–æ—É—Ç–±—É–∫–∞, –ª–æ–≥–∏—Ä—É–µ—Ç `ui.notebook.opened` |
| `[–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å]` | `openRenameDialog(id, title)` | –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω—ã–π –¥–∏–∞–ª–æ–≥ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è |
| `[–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å]` | `duplicateNotebook.mutate(id)` | –í—ã–∑—ã–≤–∞–µ—Ç API –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è |
| `[–£–¥–∞–ª–∏—Ç—å]` | `deleteNotebook.mutate(id)` | –í—ã–∑—ã–≤–∞–µ—Ç API —É–¥–∞–ª–µ–Ω–∏—è –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤) |
| `[‚Üí/‚Üê]` (–∫–Ω–æ–ø–∫–∞ –ø–∞–Ω–µ–ª–∏) | `setIsSettingsOpen(toggle)` | –°–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ |
| `[‚àí/+] –ü—Ä–æ–≤–∞–π–¥–µ—Ä LLM` | `setIsRuntimeOpen(toggle)` | –°–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –±–ª–æ–∫ LLM-–Ω–∞—Å—Ç—Ä–æ–µ–∫ |
| `[‚àí/+] –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞` | `setIsParsingOpen(toggle)` | –°–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –±–ª–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ |

#### –ú–æ–¥–∞–ª—å–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏

**–î–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ—É—Ç–±—É–∫–∞** (`isDialogOpen`):
- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ (`newNotebookName`).
- `Enter` ‚Üí `handleCreate()`: —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏–º—è (–∏–ª–∏ timestamp), –≤—ã–∑—ã–≤–∞–µ—Ç `createNotebook.mutate(title)`, –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥.
- `Escape` / `[–û—Ç–º–µ–Ω–∞]` ‚Üí `handleCancel()`.

**–î–∏–∞–ª–æ–≥ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è** (`isRenameDialogOpen`):
- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏ (`renameNotebookName`).
- `Enter` / `[–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å]` ‚Üí `handleRename()`: –≤—ã–∑—ã–≤–∞–µ—Ç `renameNotebook.mutate({id, title})`.
- `Escape` / `[–û—Ç–º–µ–Ω–∞]` ‚Üí `handleRenameCancel()`.

#### –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ (on –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é)

–ü–∞–Ω–µ–ª—å —Å –¥–≤—É–º—è —Å–µ–∫—Ü–∏—è–º–∏, sticky ‚Äî –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ —Å–∫—Ä—ã–≤–∞–µ—Ç –µ—ë:
1. **¬´–ü—Ä–æ–≤–∞–π–¥–µ—Ä LLM¬ª** ‚Äî —Ä–µ–Ω–¥–µ—Ä–∏—Ç `<RuntimeSettings />` (—Å–º. —Ä–∞–∑–¥–µ–ª 4.8).
2. **¬´–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞¬ª** ‚Äî —Ä–µ–Ω–¥–µ—Ä–∏—Ç `<ParsingSettingsPanel notebookId={activeNotebookId} />` (—Å–º. —Ä–∞–∑–¥–µ–ª 4.9).

–ö–Ω–æ–ø–∫–∞ `[‚Üí]`/`[‚Üê]` —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å—é –ø–∞–Ω–µ–ª—å –¥–æ 48px, —Å–∫—Ä—ã–≤–∞—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.

---

### 4.5 –†–∞–±–æ—á–µ–µ –æ–∫–Ω–æ –Ω–æ—É—Ç–±—É–∫–∞

**–§–∞–π–ª:** `apps/web/app/notebooks/[id]/page.tsx`

–û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω —Ä–∞–±–æ—Ç—ã —Å –Ω–æ—É—Ç–±—É–∫–æ–º. –†–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –ø–æ –º–∞—Ä—à—Ä—É—Ç—É `/notebooks/{notebookId}`.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç—Ä–∏ –∑–æ–Ω—ã)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [ConnectionIndicator]                                                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨     ‚îÇ‚ñå‚îÇ         –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –ü–ê–ù–ï–õ–¨         ‚îÇ‚ñå‚îÇ –ü–†–ê–í–ê–Ø      ‚îÇ
‚îÇ (SourcesPanel)   ‚îÇ ‚îÇ         (ChatPanel)                ‚îÇ ‚îÇ –ü–ê–ù–ï–õ–¨      ‚îÇ
‚îÇ                  ‚îÇR‚îÇ                                    ‚îÇR‚îÇ (EvidenceP) ‚îÇ
‚îÇ [‚ü®/‚ü©]           ‚îÇe‚îÇ                                    ‚îÇe‚îÇ [‚ü©/‚ü®]      ‚îÇ
‚îÇ –°–ø–∏—Å–æ–∫ –Ω–æ—É—Ç–±—É–∫–æ–≤ ‚îÇs‚îÇ [Chat]    [–û—á–∏—Å—Ç–∏—Ç—å] [–†–µ–∂–∏–º‚ñæ]      ‚îÇs‚îÇ [–¶–∏—Ç–∞—Ç—ã]   ‚îÇ
‚îÇ (select)         ‚îÇi‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇi‚îÇ [–ó–∞–º–µ—Ç–∫–∏]  ‚îÇ
‚îÇ –ü–æ–∏—Å–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ ‚îÇz‚îÇ –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π                  ‚îÇz‚îÇ            ‚îÇ
‚îÇ Upload —Ñ–∞–π–ª–∞     ‚îÇe‚îÇ –°—Ç—Ä–∏–º–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞                    ‚îÇe‚îÇ –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ‚îÇ
‚îÇ –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π  ‚îÇ ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ ‚îÇ —Ü–∏—Ç–∞—Ç—ã     ‚îÇ
‚îÇ –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤    ‚îÇL‚îÇ [–í–≤–æ–¥ –≤–æ–ø—Ä–æ—Å–∞...] [–û—Ç–ø—Ä–∞–≤–∏—Ç—å]      ‚îÇR‚îÇ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ ‚îÇ
‚îÇ                  ‚îÇ ‚îÇ                                    ‚îÇ ‚îÇ –∑–∞–º–µ—Ç–∫–∏    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ `‚ñå` ‚Äî –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–µ (drag-to-resize), —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ `startResize('left'|'right')`.

#### –ì—Ä–∞–Ω–∏—Ü—ã —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–∞–Ω–µ–ª–µ–π

```typescript
const LEFT_MIN = 240;   // px, –º–∏–Ω–∏–º—É–º –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
const LEFT_MAX = 520;   // px, –º–∞–∫—Å–∏–º—É–º –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏
const RIGHT_MIN = 280;  // px, –º–∏–Ω–∏–º—É–º –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏
const RIGHT_MAX = 640;  // px, –º–∞–∫—Å–∏–º—É–º –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏
```

#### –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (useState)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢–∏–ø | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|
| `streaming` | `string` | –ù–∞–∫–∞–ø–ª–∏–≤–∞—é—â–∏–π—Å—è —Ç–µ–∫—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç—Ä–∏–º–∞ |
| `citations` | `Citation[]` | –¶–∏—Ç–∞—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ (–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ —Å–æ–±—ã—Ç–∏—é `citations` SSE) |
| `explicitSelection` | `string[]\|null` | –Ø–≤–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (null = –≤—Å–µ enabled) |
| `leftWidth` | `number` | –®–∏—Ä–∏–Ω–∞ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –≤ px (default 320) |
| `rightWidth` | `number` | –®–∏—Ä–∏–Ω–∞ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏ –≤ px (default 360) |
| `leftCollapsed` | `boolean` | –°–≤—ë—Ä–Ω—É—Ç–∞ –ª–µ–≤–∞—è –ø–∞–Ω–µ–ª—å (44px) |
| `rightCollapsed` | `boolean` | –°–≤—ë—Ä–Ω—É—Ç–∞ –ø—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (44px) |
| `sourceConfigModal` | `SourceConfigModalState\|null` | –û—Ç–∫—Ä—ã—Ç –º–æ–¥–∞–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ |

#### –°—Ç–æ—Ä—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π

| –°—Ç–æ—Ä | –ß—Ç–æ –±–µ—Ä—ë—Ç—Å—è |
|---|---|
| `useModeStore()` | `currentMode` ‚Äî —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —á–∞—Ç–∞ |
| `useAgentStore()` | `selectedAgentId` ‚Äî –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç |
| `useChatStore()` | `isClearing` ‚Äî –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –æ—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞ |

#### TanStack Query (–¥–∞–Ω–Ω—ã–µ –∏ –º—É—Ç–∞—Ü–∏–∏)

| –•—É–∫ | Key | –î–µ–π—Å—Ç–≤–∏–µ |
|---|---|---|
| `useQuery` | `['notebooks']` | –°–ø–∏—Å–æ–∫ –Ω–æ—É—Ç–±—É–∫–æ–≤ (–¥–ª—è select –≤ SourcesPanel) |
| `useQuery` | `['agents']` | –°–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤ (–¥–ª—è select –≤ ChatPanel) |
| `useQuery` | `['sources', notebookId]` | –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –Ω–æ—É—Ç–±—É–∫–∞ |
| `useQuery` | `['messages', notebookId]` | –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ |
| `useQuery` | `['notes', notebookId]` | –ó–∞–º–µ—Ç–∫–∏ –Ω–æ—É—Ç–±—É–∫–∞ |
| `useQuery` | `['parsing-settings', notebookId]` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–¥–ª—è –º–æ–¥–∞–ª–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞) |
| `useQuery` | `['saved-citations', notebookId]` | –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã |
| `useQuery` | `['global-notes']` | –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ (cross-notebook) |
| `useMutation` | `uploadSource` | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ multipart/form-data |
| `useMutation` | `deleteSources` | –£–¥–∞–ª–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ |
| `useMutation` | `eraseSource` | –°—Ç–∏—Ä–∞–Ω–∏–µ parsing/DB –¥–∞–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è) |
| `useMutation` | `reparseSource` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ |
| `useMutation` | `updateSource` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `is_enabled` –∏–ª–∏ `individual_config` –∏—Å—Ç–æ—á–Ω–∏–∫–∞ |
| `useMutation` | `openSource` | –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (—á–µ—Ä–µ–∑ –û–°) |
| `useMutation` | `reorderSources` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (drag-and-drop) |
| `useMutation` | `createNote` | –°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É –≤ –Ω–æ—É—Ç–±—É–∫–µ |
| `useMutation` | `saveCitation` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–∏—Ç–∞—Ç—É (–∫–ª–∏–∫ –ø–æ [N] –≤ —á–∞—Ç–µ) |
| `useMutation` | `deleteSavedCitation` | –£–¥–∞–ª–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ü–∏—Ç–∞—Ç—É |
| `useMutation` | `saveGlobalNote` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –∑–∞–º–µ—Ç–∫—É (–∫–Ω–æ–ø–∫–∞ ‚Ü≥) |
| `useMutation` | `deleteGlobalNote` | –£–¥–∞–ª–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –∑–∞–º–µ—Ç–∫—É |
| `useMutation` | `clearChat` | –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ |

#### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**`sendMessage(text: string)`** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç:
1. –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `ui.message.send_attempt`.
2. –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ—Ç–æ–∫ (–µ—Å–ª–∏ –±—ã–ª) —á–µ—Ä–µ–∑ `closeStreamRef.current?.()`.
3. –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç `streaming` –∏ `citations`.
4. –°—Ç—Ä–æ–∏—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Ç–æ–∫–∞ `streamId = {notebookId}-{timestamp}`.
5. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º `streamMode` –∏–∑ `currentMode`.
6. –ü–æ–ª—É—á–∞–µ—Ç `runtimeConfig` (–ø—Ä–æ–≤–∞–π–¥–µ—Ä, –º–æ–¥–µ–ª—å, base_url, maxHistory).
7. –í—ã–∑—ã–≤–∞–µ—Ç `openChatStream(...)` –∏–∑ `lib/sse.ts`.
8. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ—Ç–æ–∫–∞ –≤ `closeStreamRef.current`.

**`handleToggleSource(sourceId)`** ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ —á–∞—Ç–µ:
- –£–ø—Ä–∞–≤–ª—è–µ—Ç `explicitSelection` (null ‚Üí –≤—Å–µ, [] ‚Üí –Ω–∏–∫—Ç–æ, [ids...] ‚Üí –≤—ã–±–æ—Ä–æ—á–Ω–æ).

**`handleDeleteSources(sourceIds, confirmText)`** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- –í—ã–∑—ã–≤–∞–µ—Ç `window.confirm(confirmText)` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
- –ü–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞ ‚Äî —É–±–∏—Ä–∞–µ—Ç —É–¥–∞–ª—ë–Ω–Ω—ã–µ ID –∏–∑ `explicitSelection`.

**`startResize(side: 'left'|'right')`** ‚Äî drag-to-resize –ø–∞–Ω–µ–ª–µ–π:
- –î–æ–±–∞–≤–ª—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `mousemove`/`mouseup`.
- –û–±–Ω–æ–≤–ª—è–µ—Ç `leftWidth`/`rightWidth` —Å —É—á—ë—Ç–æ–º MIN/MAX –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
- –ü—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Å–≤—ë—Ä–Ω—É—Ç—É—é –ø–∞–Ω–µ–ª—å.

#### –ú–æ–¥–∞–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–æ–π `‚öô` –≤ —Å—Ç—Ä–æ–∫–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –°–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Ç–æ–¥–∞ —á–∞–Ω–∫–∏–Ω–≥–∞:

| –ú–µ—Ç–æ–¥ | –ü–æ–ª—è |
|---|---|
| `general` | chunk_size, chunk_overlap |
| `context_enrichment` | chunk_size, chunk_overlap, context_window, use_llm_summary |
| `hierarchy` | doc_type, chunk_size (fallback) |
| `pcr` | parent_chunk_size, child_chunk_size |
| `symbol` | symbol_separator |
| –í—Å–µ –º–µ—Ç–æ–¥—ã | ocr_enabled, ocr_language |

–ö–∞–∂–¥—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–º–µ–µ—Ç —á–µ–∫–±–æ–∫—Å ¬´–ì–ª–æ–±–∞–ª—å–Ω—ã–π¬ª ‚Äî –µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω, –ø–æ–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞.

–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `updateSource.mutate({sourceId, payload: {individual_config: {...}}})`.

---

### 4.6 –õ–µ–≤–æ–µ –≤—ã–¥–≤–∏–∂–Ω–æ–µ –º–µ–Ω—é ‚Äî Sources Panel

**–§–∞–π–ª:** `apps/web/components/SourcesPanel.tsx`

–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –Ω–æ—É—Ç–±—É–∫–∞. –†–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `app/notebooks/[id]/page.tsx` –ø—Ä–∏ `!leftCollapsed`.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ UI (—Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Notebooks                                    ‚îÇ
‚îÇ [select: –í—ã–±–æ—Ä –Ω–æ—É—Ç–±—É–∫–∞ ‚ñæ]                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [–ù–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É]                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [Search sources]                             ‚îÇ
‚îÇ [Upload PDF/DOCX/XLSX]  (file input)         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [–í—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ]  [–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ]            ‚îÇ
‚îÇ [–ü–∞—Ä—Å–∏—Ç—å –≤—Å–µ]   [–ü–∞—Ä—Å–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ]          ‚îÇ
‚îÇ [–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ] [–£–¥–∞–ª–∏—Ç—å –Ω–µ–≤—ã–±—Ä–∞–Ω–Ω—ã–µ]    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (scrollable, max 55vh):    ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ ‚îÇ [#] ‚òë filename.pdf   [indexed] d p b     ‚îÇ‚îÇ
‚îÇ ‚îÇ                      [‚ñ∂] [‚öô] [‚úñ] [üóë]    ‚îÇ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Props –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

| Prop | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `notebooks` | `Notebook[]` | –í—Å–µ –Ω–æ—É—Ç–±—É–∫–∏ (–¥–ª—è select) |
| `activeNotebookId` | `string` | ID —Ç–µ–∫—É—â–µ–≥–æ –Ω–æ—É—Ç–±—É–∫–∞ |
| `sources` | `Source[]` | –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –Ω–æ—É—Ç–±—É–∫–∞ |
| `selectedSourceIds` | `string[]` | ID –≤–∫–ª—é—á—ë–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è —á–∞—Ç–∞ |
| `onNotebookChange` | `(id) => void` | –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥—Ä—É–≥–æ–π –Ω–æ—É—Ç–±—É–∫ |
| `onToggleSource` | `(sourceId) => void` | –í–∫–ª/–≤—ã–∫–ª –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è —á–∞—Ç–∞ |
| `onSelectAllSources` | `() => void` | –í—ã–±—Ä–∞—Ç—å –≤—Å–µ |
| `onClearSourceSelection` | `() => void` | –°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ |
| `onDeleteSelectedSources` | `() => void` | –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ |
| `onDeleteUnselectedSources` | `() => void` | –£–¥–∞–ª–∏—Ç—å –Ω–µ–≤—ã–±—Ä–∞–Ω–Ω—ã–µ |
| `onParseAllSources` | `() => void` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö |
| `onParseSelectedSources` | `() => void` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö |
| `onUpload` | `(file) => void` | –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª |
| `onEraseSource` | `(source) => void` | –°—Ç–µ—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ (–Ω–µ —Ñ–∞–π–ª) |
| `onOpenConfig` | `(source) => void` | –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ |
| `onDeleteSource` | `(source) => void` | –£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é |
| `onParseSource` | `(source) => void` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ |
| `onOpenSource` | `(source) => void` | –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –≤ –û–°-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ |
| `onReorderSources` | `(orderedIds) => void` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ—Å–ª–µ drag-and-drop |

#### –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢–∏–ø | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|
| `search` | `string` | –§–∏–ª—å—Ç—Ä –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ |
| `dragOverId` | `string\|null` | ID —Å—Ç—Ä–æ–∫–∏-—Ü–µ–ª–∏ –ø—Ä–∏ drag-and-drop |
| `dragSourceId` | `ref<string\|null>` | ID –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ |

#### –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

- `sortedSources` ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ `sort_order` (ASC), –∑–∞—Ç–µ–º –ø–æ `added_at`.
- `docNumbers` ‚Äî —Å–ª–æ–≤–∞—Ä—å `{source_id: N}` (1-based, –ø–æ –ø–æ–∑–∏—Ü–∏–∏ –≤ `sortedSources`). –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –±–µ–π–¥–∂–µ —Å–ª–µ–≤–∞.
- `visibleSources` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ `search` (case-insensitive –ø–æ `filename`).

#### Drag-and-drop

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ HTML5 Drag API:

| –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –î–µ–π—Å—Ç–≤–∏–µ |
|---|---|
| `handleDragStart(e, sourceId)` | –ó–∞–ø–æ–º–∏–Ω–∞–µ—Ç `dragSourceId.current = sourceId`, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `effectAllowed = 'move'` |
| `handleDragOver(e, targetId)` | `e.preventDefault()`, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `dragOverId = targetId` (–≤–∏–∑—É–∞–ª—å–Ω—ã–π highlight) |
| `handleDrop(e, targetId)` | –°—Ç—Ä–æ–∏—Ç –Ω–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫: –≤—ã—Ä–µ–∑–∞–µ—Ç `fromId` –∏–∑ –º–∞—Å—Å–∏–≤–∞, –≤—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞ –ø–æ–∑–∏—Ü–∏—é `targetId`, –≤—ã–∑—ã–≤–∞–µ—Ç `onReorderSources(newOrder)` |
| `handleDragEnd()` | –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç `dragOverId` –∏ `dragSourceId.current` |

#### –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–æ–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

| –≠–ª–µ–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| `[#]` | –ë–µ–π–¥–∂ —Å –ø–æ—Ä—è–¥–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –Ω–æ—É—Ç–±—É–∫–µ (1-based, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç [N] –≤ —Ü–∏—Ç–∞—Ç–∞—Ö) |
| `‚òë` (checkbox) | –í–∫–ª/–≤—ã–∫–ª –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —á–∞—Ç–∞ ‚Üí `onToggleSource` |
| `filename` | –ò–º—è —Ñ–∞–π–ª–∞ (truncate –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏). –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ ‚Üí `onOpenSource` |
| `[status]` | –ë–µ–π–¥–∂ —Å—Ç–∞—Ç—É—Å–∞: `new` / `indexing` / `indexed` / `failed` |
| `d p b` | –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã-–ª–∞–º–ø–æ—á–∫–∏ (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç `Lamp`): **d** ‚Äî `has_docs`, **p** ‚Äî `has_parsing`, **b** ‚Äî `has_base` |
| `[‚ñ∂]` | –ö–Ω–æ–ø–∫–∞ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ ‚Üí `onParseSource` |
| `[‚öô]` | –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–∞–π–ª–∞ ‚Üí `onOpenConfig` (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ) |
| `[‚úñ]` | –°—Ç–µ—Ä–µ—Ç—å parsing/base –¥–∞–Ω–Ω—ã–µ, —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è ‚Üí `onEraseSource` (—Å `window.confirm`) |
| `[üóë]` | –£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Ñ–∞–π–ª + –¥–∞–Ω–Ω—ã–µ + DB) ‚Üí `onDeleteSource` |

#### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ —Å–∫—Ä—ã—Ç—ã–π `<input type="file">`, –æ–±—ë—Ä–Ω—É—Ç—ã–π –≤ `<label>`. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `onUpload(file)`. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ UI (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ).

---

### 4.7 –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å —á–∞—Ç–∞

**–§–∞–π–ª:** `apps/web/components/ChatPanel.tsx`

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ UI

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [h2: Chat]         [–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç] [–ê–≥–µ–Ω—Ç‚ñæ] [–†–µ–∂–∏–º‚ñæ]       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π (flex-1, min-h-40vh, overflow-auto):    ‚îÇ
‚îÇ                                                            ‚îÇ
‚îÇ  [user]  –í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                              ‚îÇ
‚îÇ  [assistant] –û—Ç–≤–µ—Ç —Å [1][2] —Å—Å—ã–ª–∫–∞–º–∏        [‚Ü≥]           ‚îÇ
‚îÇ  ...                                                       ‚îÇ
‚îÇ  [–¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–º, –µ—Å–ª–∏ –µ—Å—Ç—å]                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å...]                   [–û—Ç–ø—Ä–∞–≤–∏—Ç—å]         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ (–µ—Å–ª–∏ —Å—Ç—Ä–∏–º –∞–∫—Ç–∏–≤–µ–Ω): [Copy] [–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ó–∞–º–µ—Ç–∫–∏]        ‚îÇ
‚îÇ                        –ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤: N                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Props

| Prop | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `notebookId` | `string` | ID –Ω–æ—É—Ç–±—É–∫–∞ |
| `mode` | `ChatMode` | –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: `'rag' \| 'model' \| 'agent'` |
| `agentId` | `string` | ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ |
| `agents` | `AgentManifest[]` | –°–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤ (–¥–ª—è select, –≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ `agent`) |
| `messages` | `ChatMessage[]` | –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π |
| `streaming` | `string` | –¢–µ–∫—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç—Ä–∏–º–∞ |
| `citations` | `Citation[]` | –¶–∏—Ç–∞—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ |
| `disableSend` | `boolean` | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —á–∞—Ç–∞) |
| `disableClearChat` | `boolean` | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—á–∏—Å—Ç–∫–∏ |
| `onModeChange` | `(mode) => void` | –°–º–µ–Ω–∞ —Ä–µ–∂–∏–º–∞ |
| `onAgentChange` | `(agentId) => void` | –°–º–µ–Ω–∞ –∞–≥–µ–Ω—Ç–∞ |
| `onSend` | `(text) => void` | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è |
| `onClearChat` | `() => void` | –û—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞ |
| `onSaveToNotes` | `(text) => void` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞–º–µ—Ç–∫–∏ |
| `onCitationClick` | `(citation) => void` | –ö–ª–∏–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ü–∏—Ç–∞—Ç—ã |

#### –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢–∏–ø | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|
| `input` | `string` | –¢–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–ª—è –≤–≤–æ–¥–∞ |

#### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

- `Enter` (–±–µ–∑ Shift) ‚Üí `onSend(input.trim())`, —Å–±—Ä–æ—Å –ø–æ–ª—è.
- –ö–Ω–æ–ø–∫–∞ `[–û—Ç–ø—Ä–∞–≤–∏—Ç—å]` ‚Üí —Ç–æ –∂–µ.
- `Shift+Enter` ‚Äî –≤—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ textarea).

#### –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ü–∏—Ç–∞—Ç –≤ —Ç–µ–∫—Å—Ç–µ (`parseTextWithCitations` + `CitationRef`)

–§—É–Ω–∫—Ü–∏—è `parseTextWithCitations(text)` —Ä–∞–∑–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã:
- `{type: 'text', content: '...'}` ‚Äî –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç.
- `{type: 'ref', num: N}` ‚Äî —Å—Å—ã–ª–∫–∞ `[N]`.

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `CitationRef` –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Å—ã–ª–∫–∏:
- –ò—â–µ—Ç –≤ `citations[]` —Ü–∏—Ç–∞—Ç—É —Å `doc_order === N`.
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–∏–Ω—é—é –∫–Ω–æ–ø–∫—É `[N]`, –ø—Ä–∏ –∫–ª–∏–∫–µ ‚Üí `onCitationClick(citation)`.
- –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç `[N]`.

#### –†–µ–∂–∏–º—ã —á–∞—Ç–∞ (select)

–û–ø—Ü–∏–∏ –∏–∑ `CHAT_MODE_OPTIONS` (`lib/sse.ts`):
- `'rag'` ‚Äî ¬´RAG¬ª (–ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º)
- `'model'` ‚Äî ¬´–ú–æ–¥–µ–ª—å¬ª (–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º, LLM —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏)
- `'agent'` ‚Äî ¬´–ê–≥–µ–Ω—Ç¬ª (–∑–∞–≥–ª—É—à–∫–∞)

–ü—Ä–∏ —Ä–µ–∂–∏–º–µ `agent` –∏ –Ω–∞–ª–∏—á–∏–∏ –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π select ‚Äî –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞.

---
